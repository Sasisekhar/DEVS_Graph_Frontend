<!DOCTYPE html>
<html>
<head>
  <title>Groups with Ports</title>
  <!-- Copyright 1998-2022 by Northwoods Software Corporation. -->
  <meta name="description" content="">
  <meta name="viewport" content="width=device-width, initial-scale=1">
</head>
<body>
  <div id="myDiagramDiv" style="border: solid 1px black; width:100%; height:600px"></div>
  <textarea id="mySavedModel" style="width:100%;height:250px"></textarea>

  <script src="https://unpkg.com/gojs"></script>
  <script id="code">
const $ = go.GraphObject.make;

myDiagram =
  new go.Diagram("myDiagramDiv",
    {
      layout: $(go.TreeLayout),
      "undoManager.isEnabled": true,
      "ModelChanged": e => {     // just for demonstration purposes,
        if (e.isTransactionFinished) {  // show the model data in the page's TextArea
          document.getElementById("mySavedModel").textContent = e.model.toJson();
        }
      }
    });

myDiagram.groupTemplate =
  $(go.Group, "Table",
    $(go.Panel, "Vertical",
      new go.Binding("itemArray", "I"),
      {
        column: 0,
        itemTemplate:
          $(go.Panel,
            { margin: 1 },
            $(go.Shape,
              { toLinkable: true, strokeWidth: 0, width: 8, height: 8 },
              new go.Binding("portId", "id"))
          )
      }
    ),
    $(go.Panel, "Auto",
      { column: 1 },
      $(go.Shape, { fill: "transparent" }),
      $(go.Placeholder, { padding: 10 })
    ),
    $(go.Panel, "Vertical",
      new go.Binding("itemArray", "O"),
      {
        column: 2,
        itemTemplate:
          $(go.Panel,
            { margin: 1 },
            $(go.Shape,
              { fromLinkable: true, strokeWidth: 0, width: 8, height: 8 },
              new go.Binding("portId", "id"))
          )
      }
    ),
    {
      contextMenu: $("ContextMenu",
          $("ContextMenuButton",
            $(go.TextBlock, "Add Input"),
            { click: (e, obj) => addPort("I") }),
          $("ContextMenuButton",
            $(go.TextBlock,"Add Output"),
            { click: (e, obj) => addPort("O") })
        )
    }
  );

// Add a port to the specified side of the selected nodes.
function addPort(side) {
  myDiagram.startTransaction("addPort");
  myDiagram.selection.each(node => {
    // skip any selected Links
    if (!(node instanceof go.Node)) return;
    // compute the next available index number for the side
    let i = 1;
    while (node.findPort(side + i.toString()) !== node) i++;
    // now this new port name is unique within the whole Node because of the side prefix
    const name = side + i.toString();
    // get the Array of port data to be modified
    const arr = node.data[side];
    if (arr) {
      // create a new port data object
      const newportdata = { id: name };
      // and add it to the Array of port data
      myDiagram.model.addArrayItem(arr, newportdata);
    }
  });
  myDiagram.commitTransaction("addPort");
}


myDiagram.model =
  new go.GraphLinksModel(
    {
      linkToPortIdProperty: "topid",
      linkFromPortIdProperty: "frompid",
      nodeDataArray: [
        { key: 1, isGroup: true,
          I: [
            { id: "I1" },
            { id: "I2" }
          ],
          O: [
            { id: "O1" }
          ]
        },
        { key: 2, isGroup: true,
          I: [
            { id: "I1" },
            { id: "I2" }
          ],
          O: [
            { id: "O1" }
          ]
        },
        { group: 1 },
        { group: 1 },
        { group: 1 },
        { group: 2 }
      ],
      linkDataArray: [
        { from: 1, frompid: "O1", to: 2, topid: "I2" }
      ]
    });
  </script>
</body>
</html>